!function($){"use strict";var defaults={method:"GET",icon:"arrow-r",cancelRequests:!1,target:$(),source:null,callback:null,link:null,minLength:0,transition:"fade",matchFromStart:!0},openXHR={},buildItems=function($this,data,settings){var str=[];data&&$.each(data,function(index,value){str.push($.isPlainObject(value)?"<li data-icon="+settings.icon+'><a href="'+settings.link+encodeURIComponent(value.value)+'" data-transition="'+settings.transition+"\" data-autocomplete='"+JSON.stringify(value)+"'>"+value.label+"</a></li>":"<li data-icon="+settings.icon+'><a href="'+settings.link+encodeURIComponent(value)+'" data-transition="'+settings.transition+'">'+value+"</a></li>")}),$(settings.target).html(str.join("")).listview("refresh"),null!==settings.callback&&$.isFunction(settings.callback)&&attachCallback(settings),$this.trigger(str.length>0?"targetUpdated.autocomplete":"targetCleared.autocomplete")},attachCallback=function(settings){$("li a",$(settings.target)).bind("click.autocomplete",function(e){e.stopPropagation(),e.preventDefault(),settings.callback(e)})},clearTarget=function($this,$target){$target.html("").listview("refresh").closest("fieldset").removeClass("ui-search-active"),$this.trigger("targetCleared.autocomplete")},handleInput=function(){var text,data,element_text,re,$this=$(this),id=$this.attr("id"),settings=$this.jqmData("autocomplete");settings&&(text=$this.val(),text.length<settings.minLength?clearTarget($this,$(settings.target)):$.isArray(settings.source)?(data=settings.source.sort().filter(function(element){return re=settings.matchFromStart?new RegExp("^"+text,"i"):new RegExp(text,"i"),element_text=$.isPlainObject(element)?element.label:element,re.test(element_text)}),buildItems($this,data,settings)):"function"==typeof settings.source?settings.source(text,function(data){buildItems($this,data,settings)}):$.ajax({type:settings.method,url:settings.source,data:{term:text},beforeSend:function(jqXHR){settings.cancelRequests&&(openXHR[id]?openXHR[id].abort():(settings.target.html('<li data-icon="none"><a href="#">Searching...</a></li>').listview("refresh"),settings.target.closest("fieldset").addClass("ui-search-active")),openXHR[id]=jqXHR)},success:function(data){buildItems($this,data,settings)},complete:function(){settings.cancelRequests&&(openXHR[id]=null)},dataType:"json"}))},methods={init:function(options){var el=this;el.jqmData("autocomplete",$.extend({},defaults,options));var settings=el.jqmData("autocomplete");return el.unbind("keyup.autocomplete").bind("keyup.autocomplete",handleInput).next(".ui-input-clear").bind("click",function(){clearTarget(el,$(settings.target))})},update:function(options){var settings=this.jqmData("autocomplete");return settings&&this.jqmData("autocomplete",$.extend(settings,options)),this},clear:function(){var settings=this.jqmData("autocomplete");return settings&&clearTarget(this,$(settings.target)),this},destroy:function(){var settings=this.jqmData("autocomplete");return settings&&(clearTarget(this,$(settings.target)),this.jqmRemoveData("autocomplete"),this.unbind(".autocomplete")),this}};$.fn.autocomplete=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void 0:methods.init.apply(this,arguments)}}(jQuery);